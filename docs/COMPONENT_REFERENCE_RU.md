# MegaBonk Overlay -- Справочник компонентов (Элементы)

Данный документ содержит полный справочник по всем типам элементов оверлея MegaBonk Overlay. Для каждого элемента описано: что он отображает, какие данные читает, как на него влияет контекстное меню и каково его поведение видимости.

---

## Содержание

- [Общие свойства (все элементы)](#общие-свойства-все-элементы)
- [Справочник контекстного меню (все элементы)](#справочник-контекстного-меню-все-элементы)
- [Элементы экипировки](#элементы-экипировки)
- [Элементы предметов](#элементы-предметов)
- [Элементы характеристик (группы)](#элементы-характеристик-группы)
- [Элементы характеристик (индивидуальные)](#элементы-характеристик-индивидуальные)
- [Боевые элементы (группы)](#боевые-элементы-группы)
- [Боевые элементы (индивидуальные)](#боевые-элементы-индивидуальные)
- [Элементы информации об игре](#элементы-информации-об-игре)
- [Элементы матча](#элементы-матча)
- [Элементы сессии](#элементы-сессии)
- [Элементы сезона](#элементы-сезона)
- [Элементы банов](#элементы-банов)
- [Элементы разниц](#элементы-разниц)
- [Элементы фигур](#элементы-фигур)

---

## Общие свойства (все элементы)

Каждый элемент оверлея обладает следующими общими свойствами:

| Свойство | Описание | По умолчанию |
|----------|----------|-------------|
| `id` | Уникальный идентификатор элемента (генерируется автоматически) | `element-{timestamp}-{random}` |
| `type` | Строка типа элемента (определяет отображаемый компонент) | -- |
| `playerId` | Слот игрока: `1` (вы/игрок 1), `2` (оппонент/игрок 2) или `null` (общий) | Зависит от типа |
| `position` | Координаты `{ x, y }` на холсте (в пикселях) | `{ x: 100, y: 100 }` |
| `size` | `{ width, height }` в пикселях | Зависит от типа |
| `scale` | Множитель визуального масштаба | `1` |
| `opacity` | Визуальная прозрачность (0.0 - 1.0) | `1` |
| `zIndex` | Порядок наложения (выше = поверх) | Автоинкремент |
| `layout.align` | Выравнивание содержимого: `left`, `center`, `right` | `left` |
| `layout.flow` | Направление flex-потока для многоэлементных: `row`, `column` | `row` |
| `layout.justify` | Распределение содержимого: `start`, `center`, `end`, `space-between`, `space-around` | `start` |
| `layout.hideTitle` | Скрыт ли заголовок элемента | `false` |
| `layout.title` | Переопределение текста заголовка | `undefined` (используется метка по умолчанию) |
| `layout.obsVisibility` | Режим видимости в OBS: `always`, `run`, `off` | `always` |
| `layout.obsVisibilityPhases` | Массив фаз матча, во время которых элемент виден | `undefined` (все фазы) |
| `layout.matchEnd.blurOnEnd` | Применяется ли размытие при завершении матча | `false` (следует глобальной настройке) |
| `layout.matchEnd.showEndTitle` | Показывать ли надпись Победа/Поражение/Ничья | `false` |
| `layout.matchEnd.blurAmount` | Сила размытия в пикселях (0-16) | `6` |
| `layout.matchEnd.desaturate` | Степень обесцвечивания (0.0-1.0) | `0.6` |
| `layout.matchEnd.dim` | Степень затемнения (0.0-1.0) | `0.2` |
| `layout.lockScale` | Заблокировать масштаб содержимого к базовому размеру | `false` |
| `layout.baseSize` | Базовый размер для расчёта заблокированного масштаба | `null` |

### Общие элементы vs элементы по игрокам

Элементы делятся на **привязанные к игроку** и **общие**:

- **Привязанные к игроку** назначаются Игроку 1 или Игроку 2, отображая данные конкретного игрока. Они появляются в соответствующих вкладках P1 или P2 на боковой панели.
- **Общие элементы** имеют `playerId: null` и отображают данные, общие для матча (разницы, ход матча, баны, информация о сезоне, статистика сессии). Они отображаются в обеих вкладках боковой панели.

Типы общих элементов: `time-diff`, `difficulty-diff`, `kill-diff`, `match-flow`, `match-search`, `match-ban-selection`, `match-ban-animation`, `match-opponent-wait`, `match-smart`, `session-summary`, `session-current`, `session-rating`, `session-rank`, `session-games`, `season-info`, `season-name`, `season-time-limit`, `season-pause-limit`, `season-start-date`, `season-end-date`, `bans-system`, `bans-player1`, `bans-player2`.

---

## Справочник контекстного меню (все элементы)

Правый клик по любому элементу открывает контекстное меню. Следующие опции доступны для всех элементов (некоторые с ограничениями):

| Пункт меню | Описание | Доступность |
|------------|----------|-------------|
| **Экспорт элементов** | Копирует выбранные элементы как закодированную строку в буфер обмена | Всегда |
| **Удалить элемент** | Удаляет элемент (или все выбранные элементы) | Всегда |
| **Выравнивание содержимого** | Подменю: Лево / Центр / Право -- устанавливает горизонтальное выравнивание | Всегда |
| **Распределение содержимого** | Подменю: Начало / Центр / Конец / Space Between / Space Around | Всегда |
| **Направление потока** | Подменю: Строка / Столбец -- устанавливает направление flex | Всегда |
| **Порядок предметов** | Подменю: По редкости / По получению -- устанавливает сортировку предметов | Только для `item-group` и `rarity-group-*` |
| **Поля** | Подменю: Включение/выключение отдельных полей | Только для сгруппированных элементов характеристик/боевых |
| **Лимиты редкости** | Подменю: Максимум предметов по уровню редкости (Авто, 1-5) | Только для `item-group`, `rarity-group-*`, и `bans-*` |
| **Экспериментально** | Подменю: Горизонтальный отступ (0-20px), Вертикальный отступ (0-20px) | Только при включённых расширенных настройках, только для предметов/оружия/книг/банов |
| **Цвет заливки** | Палитра выбора цвета фона | Только для `shape-rect` |
| **Цвет текста** | Палитра выбора цвета текста | Только для элементов сезона |
| **Видимость в OBS** | Подменю: Выключено / Всегда / Во время раунда / По фазам (Покой, Поиск, Принятие, Фаза банов, Игра, Конец матча) | Всегда |
| **Масштаб** | Ползунок: 0.25x - 2.0x | Всегда |
| **Прозрачность** | Ползунок: 0% - 100% | Всегда |
| **Эффекты конца матча** | Подменю: Размытие при завершении (вкл/выкл), Показать надпись (вкл/выкл), Сила размытия (0-16px), Обесцвечивание (0-100%), Затемнение (0-100%) | Всегда |
| **Изменить заголовок** | Подменю: Установить заголовок (диалог), Очистить заголовок, Показать/Скрыть заголовок | Всегда |
| **Изменить метку** | Подменю: Установить метку (диалог), Очистить метку, Показать/Скрыть метку | Только для элементов категорий `stats-individual` и `combat-individual` |
| **Позиция события** | Подменю: Над таймером / Под таймером | Только для элемента `stage-state` |
| **Z-индекс** | Подменю: На передний план / На задний план / Вперёд / Назад | Всегда |
| **Добавить в группу** | Подменю со списком существующих групп | Когда существуют группы |
| **Сгруппировать выбранные** | Группирует все выбранные элементы (требуется 2+ несгруппированных) | Только при множественном выделении |
| **Разгруппировать** | Извлекает элемент из его группы | Только когда элемент находится в группе |

---

## Элементы экипировки

### Герой (`hero`)

| Свойство | Значение |
|----------|----------|
| Категория | `equipment` |
| Размер по умолчанию | 120 x 140 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.id`, разрешается через `gameDataStore` |
| Отображает | Иконку героя, опционально имя героя |
| Источник иконок | Локальный (`/Game Icons/Heroes/{name}.webp`) или CDN (из поля `imageSrc` API игры) |

### Оружие (`weapons`)

| Свойство | Значение |
|----------|----------|
| Категория | `equipment` |
| Размер по умолчанию | 200 x 80 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.equipment.weapons` (массив) |
| Отображает | Строку/столбец иконок оружия с индикатором уровня |
| Источник иконок | Локальные или CDN-изображения оружия |
| Дополнительно в контекстном меню | Направление потока, выравнивание, настройка отступов (экспериментально) |

### Книги (`tomes`)

| Свойство | Значение |
|----------|----------|
| Категория | `equipment` |
| Размер по умолчанию | 280 x 80 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.equipment.tomes` (массив) |
| Отображает | Строку/столбец иконок книг с индикатором уровня |
| Источник иконок | Локальные или CDN-изображения книг |
| Дополнительно в контекстном меню | Направление потока, выравнивание, настройка отступов (экспериментально) |

### Bonk Classic (`bonk-classic`)

| Свойство | Значение |
|----------|----------|
| Категория | `equipment` |
| Размер по умолчанию | 280 x 170 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.equipment.weapons` + `playerState.equipment.tomes` |
| Отображает | Комбинированный макет: строка оружия сверху, строка книг снизу (классический вид) |

---

## Элементы предметов

### Все предметы (`item-group`)

| Свойство | Значение |
|----------|----------|
| Категория | `items` |
| Размер по умолчанию | 450 x 300 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.equipment.items` (массив) |
| Отображает | Все предметы, сгруппированные по уровням редкости с цветными рамками. Сортировка по редкости (Обычные -> Редкие -> Эпические -> Легендарные) или по порядку получения. |
| Дополнительно в контекстном меню | Порядок предметов (редкость/получение), Лимиты редкости, Поток, Выравнивание, Отступы |
| Переполнение | Видимое (содержимое может выходить за границы элемента) |

### Обычные предметы (`rarity-group-common`)

| Свойство | Значение |
|----------|----------|
| Категория | `items` |
| Размер по умолчанию | 200 x 60 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.equipment.items`, отфильтрованные по редкости `0` (Обычные/Зелёные) |
| Отображает | Только обычные (зелёные) предметы с индикаторами количества |

### Редкие предметы (`rarity-group-rare`)

Аналогичная структура как у Обычных предметов, но фильтрация по редкости `1` (Редкие/Синие).

### Эпические предметы (`rarity-group-epic`)

Аналогичная структура как у Обычных предметов, но фильтрация по редкости `2` (Эпические/Фиолетовые).

### Легендарные предметы (`rarity-group-legendary`)

Аналогичная структура как у Обычных предметов, но фильтрация по редкости `3` (Легендарные/Золотые).

---

## Элементы характеристик (группы)

Групповые элементы характеристик отображают несколько связанных характеристик в одном элементе. Каждую характеристику внутри группы можно индивидуально включить/отключить через контекстное меню **Поля**.

### Характеристики здоровья (`stats-health`)

| Свойство | Значение |
|----------|----------|
| Категория | `stats` |
| Размер по умолчанию | 180 x 120 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.stats` |
| Поля | Макс. HP, Регенерация, Щит, Сверхисцеление, Множитель исцеления, Кража жизни |

### Характеристики урона (`stats-damage`)

| Свойство | Значение |
|----------|----------|
| Категория | `stats` |
| Размер по умолчанию | 180 x 140 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.stats` |
| Поля | Множитель урона, Скорость атаки, Шанс крита, Урон крита, Снаряды, Отскоки, Размер |

### Характеристики защиты (`stats-defense`)

| Свойство | Значение |
|----------|----------|
| Категория | `stats` |
| Размер по умолчанию | 180 x 100 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.stats` |
| Поля | Броня, Уклонение, Шипы, Снижение урона, Снижение урона от падения |

### Характеристики вспомогательные (`stats-utility`)

| Свойство | Значение |
|----------|----------|
| Категория | `stats` |
| Размер по умолчанию | 180 x 120 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.stats` |
| Поля | Скорость бега, Высота прыжка, Доп. прыжки, Радиус подбора, Длительность, Скорость снарядов |

### Характеристики экономики (`stats-economy`)

| Свойство | Значение |
|----------|----------|
| Категория | `stats` |
| Размер по умолчанию | 180 x 120 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.stats` |
| Поля | Множитель золота, Множитель опыта, Множитель серебра, Удача, Множитель сундуков, Скидка в магазине |

### Характеристики врагов (`stats-enemy`)

| Свойство | Значение |
|----------|----------|
| Категория | `stats` |
| Размер по умолчанию | 180 x 120 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.stats` |
| Поля | Сложность, Элитные враги, Количество врагов, Размер врагов, Скорость врагов, HP врагов, Урон врагов |

---

## Элементы характеристик (индивидуальные)

Индивидуальные элементы характеристик отображают одно значение. Через контекстное меню **Изменить метку** можно переопределить название характеристики, а через **Скрыть метку** -- показать только значение.

Все индивидуальные элементы характеристик имеют общие параметры:
- Категория: `stats-individual`
- Размер по умолчанию: 120 x 40 пикселей
- Привязан к игроку: Да
- Источник данных: `playerState.character.stats`

| Тип элемента | Метка | Ключ характеристики |
|-------------|-------|---------------------|
| `stat-maxhealth` | Макс. здоровье | `maxHealth` |
| `stat-healthregen` | Регенерация здоровья | `healthRegen` |
| `stat-shield` | Щит | `shield` |
| `stat-overheal` | Сверхисцеление | `overheal` |
| `stat-healingmultiplier` | Множитель исцеления | `healingMultiplier` |
| `stat-lifesteal` | Кража жизни | `lifesteal` |
| `stat-damagemultiplier` | Множитель урона | `damageMultiplier` |
| `stat-attackspeed` | Скорость атаки | `attackSpeed` |
| `stat-critchance` | Шанс крита | `critChance` |
| `stat-critdamage` | Урон крита | `critDamage` |
| `stat-projectiles` | Снаряды | `projectiles` |
| `stat-projectilebounces` | Отскоки | `projectileBounces` |
| `stat-projectilespeedmultiplier` | Скорость снарядов | `projectileSpeedMultiplier` |
| `stat-armor` | Броня | `armor` |
| `stat-evasion` | Уклонение | `evasion` |
| `stat-thorns` | Шипы | `thorns` |
| `stat-damagereductionmultiplier` | Снижение урона | `damageReductionMultiplier` |
| `stat-firedamage` | Урон огнём | `fireDamage` |
| `stat-icedamage` | Урон льдом | `iceDamage` |
| `stat-lightningdamage` | Урон молнией | `lightningDamage` |
| `stat-burnchance` | Шанс поджога | `burnChance` |
| `stat-freezechance` | Шанс заморозки | `freezeChance` |
| `stat-movespeedmultiplier` | Скорость бега | `moveSpeedMultiplier` |
| `stat-jumpheight` | Высота прыжка | `jumpHeight` |
| `stat-extrajumps` | Доп. прыжки | `extraJumps` |
| `stat-pickuprange` | Радиус подбора | `pickupRange` |
| `stat-sizemultiplier` | Размер | `sizeMultiplier` |
| `stat-durationmultiplier` | Длительность | `durationMultiplier` |
| `stat-knockbackmultiplier` | Отбрасывание | `knockbackMultiplier` |
| `stat-luck` | Удача | `luck` |
| `stat-goldincreasemultiplier` | Множитель золота | `goldIncreaseMultiplier` |
| `stat-xpincreasemultiplier` | Множитель опыта | `xpIncreaseMultiplier` |
| `stat-silverincreasemultiplier` | Множитель серебра | `silverIncreaseMultiplier` |
| `stat-chestincreasemultiplier` | Множитель сундуков | `chestIncreaseMultiplier` |
| `stat-chestpricemultiplier` | Цена сундуков | `chestPriceMultiplier` |
| `stat-shoppricereduction` | Скидка в магазине | `shopPriceReduction` |
| `stat-powerupboostmultiplier` | Усиление бустов | `powerupBoostMultiplier` |
| `stat-powerupchance` | Шанс буста | `powerupChance` |
| `stat-difficulty` | Сложность | `difficulty` |
| `stat-difficulty-icon` | Сложность (иконка) | `difficulty` (с иконкой черепа) |
| `stat-elitespawnincrease` | Элитные враги | `eliteSpawnIncrease` |
| `stat-enemyamountmultiplier` | Количество врагов | `enemyAmountMultiplier` |
| `stat-enemysizemultiplier` | Размер врагов | `enemySizeMultiplier` |
| `stat-enemyspeedmultiplier` | Скорость врагов | `enemySpeedMultiplier` |
| `stat-enemyhpmultiplier` | HP врагов | `enemyHpMultiplier` |
| `stat-enemydamagemultiplier` | Урон врагов | `enemyDamageMultiplier` |
| `stat-enemyscalingmultiplier` | Масштабирование врагов | `enemyScalingMultiplier` |
| `stat-elitedamagemultiplier` | Урон элитных | `eliteDamageMultiplier` |
| `stat-holiness` | Святость | `holiness` |
| `stat-wickedness` | Нечестивость | `wickedness` |
| `stat-evolve` | Эволюция | `evolve` |
| `stat-weaponburstcooldown` | КД серии | `weaponBurstCooldown` |
| `stat-damagecooldownmultiplier` | КД урона множ. | `damageCooldownMultiplier` |
| `stat-effectdurationmultiplier` | Длительность эффектов | `effectDurationMultiplier` |
| `stat-falldamagereduction` | Сниж. урона пад. | `fallDamageReduction` |
| `stat-slam` | Удар | `slam` |

---

## Боевые элементы (группы)

### Боевая статистика (`combat-stats`)

| Свойство | Значение |
|----------|----------|
| Категория | `combat` |
| Размер по умолчанию | 200 x 140 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.combat` |
| Поля (переключаемые) | Убийства, Золото, Нанесённый урон, Полученный урон |

### Статистика святилищ (`shrine-stats`)

| Свойство | Значение |
|----------|----------|
| Категория | `combat` |
| Размер по умолчанию | 200 x 160 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.combat.shrines` |
| Поля (переключаемые) | Баланс, Жадность, Вызов, Проклятие, Магнит, Моаи, Заряд, Золотой заряд |

### Игровая статистика (`game-stats`)

| Свойство | Значение |
|----------|----------|
| Категория | `combat` |
| Размер по умолчанию | 240 x 200 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.combat.gameStats` |
| Поля (переключаемые) | Заработано золота, Потрачено золота, Получено опыта, Убийства элитных, Убийства боссов, Убийства мини-боссов, Убийства скелетов, Убийства гоблинов, Убийства огнём, Убийства молнией, Криты, Уклонения, Запущено снарядов, Подобрано предметов, Открыто сундуков, Куплено сундуков, Разбито горшков, Использовано усилений |

### Источники урона (`damage-sources`)

| Свойство | Значение |
|----------|----------|
| Категория | `combat` |
| Размер по умолчанию | 220 x 180 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.combat.damageSources` |
| Отображает | Распределение урона по источникам (оружие/навык) с процентами |

---

## Боевые элементы (индивидуальные)

Индивидуальные элементы боевой статистики. Поддерживают контекстное меню **Скрыть метку**.

Общие параметры:
- Категория: `combat-individual`
- Размер по умолчанию: 120 x 40 пикселей (некоторые 140 x 40)
- Привязан к игроку: Да

| Тип элемента | Метка | Источник данных |
|-------------|-------|-----------------|
| `combat-killcount` | Счётчик убийств | `combat.killCount` |
| `combat-killtick` | Тик убийств | Дельта из истории отслеживания убийств (последние 10 сэмплов) |
| `combat-currentgold` | Текущее золото | `combat.currentGold` |
| `combat-totaldamagedealt` | Нанесённый урон | `combat.totalDamageDealt` |
| `combat-totaldamagetaken` | Полученный урон | `combat.totalDamageTaken` |
| `combat-chestsnormal` | Обычные сундуки | `combat.chests.normal` |
| `combat-chestscorrupt` | Проклятые сундуки | `combat.chests.corrupt` |
| `combat-chestsfree` | Бесплатные сундуки | `combat.chests.free` |
| `combat-shrinebalance` | Святилища баланса | `combat.shrines.balance` |
| `combat-shrinegreed` | Святилища жадности | `combat.shrines.greed` |
| `combat-shrinechallenge` | Святилища вызова | `combat.shrines.challenge` |
| `combat-shrinecursed` | Проклятые святилища | `combat.shrines.cursed` |
| `combat-shrinemagnet` | Святилища магнита | `combat.shrines.magnet` |
| `combat-shrinemoai` | Святилища моаи | `combat.shrines.moai` |
| `combat-shrinechargenormal` | Святилища заряда | `combat.shrines.charge` |
| `combat-shrinechargegolden` | Золотые заряды | `combat.shrines.goldenCharge` |
| `combat-goldearned` | Заработано золота | `combat.gameStats.goldEarned` |
| `combat-goldspent` | Потрачено золота | `combat.gameStats.goldSpent` |
| `combat-silverearned` | Заработано серебра | `combat.gameStats.silverEarned` |
| `combat-xpgained` | Получено опыта | `combat.gameStats.xpGained` |
| `combat-elitekills` | Убийства элитных | `combat.gameStats.eliteKills` |
| `combat-bosskills` | Убийства боссов | `combat.gameStats.bossKills` |
| `combat-minibosskills` | Убийства мини-боссов | `combat.gameStats.minibossKills` |
| `combat-finalbosskills` | Убийства фин. боссов | `combat.gameStats.finalBossKills` |
| `combat-crits` | Критические удары | `combat.gameStats.crits` |
| `combat-evades` | Уклонения | `combat.gameStats.evades` |
| `combat-projectilesfired` | Запущено снарядов | `combat.gameStats.projectilesFired` |
| `combat-lifestealhealing` | Исцеление кражей жизни | `combat.gameStats.lifestealHealing` |
| `combat-itemspickedup` | Подобрано предметов | `combat.gameStats.itemsPickedUp` |
| `combat-chestsopened` | Открыто сундуков | `combat.gameStats.chestsOpened` |
| `combat-chestsbought` | Куплено сундуков | `combat.gameStats.chestsBought` |
| `combat-potsbroken` | Разбито горшков | `combat.gameStats.potsBroken` |
| `combat-powerupsused` | Использовано усилений | `combat.gameStats.powerupsUsed` |

---

## Элементы информации об игре

### Игровое время (`game-time`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 160 x 80 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.timeElapsed`, `playerState.isPaused`, `playerState.pauseTime`, лимит времени сезона |
| Отображает | Прошедшее или оставшееся время (в зависимости от настройки направления таймера), индикатор паузы |
| Поведение | Направление таймера управляется глобальной настройкой `timeFlowDirection`. При значении "remaining" ведёт обратный отсчёт от лимита времени сезона. |

### Уровень (`game-level`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 100 x 40 пикселей |
| Привязан к игроку | Да |
| Источник данных | `playerState.character.level` |
| Отображает | Текущий уровень персонажа |

### Лимит пауз (`pause-limit`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 140 x 48 пикселей |
| Привязан к игроку | Да |
| Источник данных | `pauseLimit` из данных сезона |
| Отображает | Общее допустимое время пауз для сезона |

### Оставшиеся паузы (`pause-remaining`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 160 x 48 пикселей |
| Привязан к игроку | Да |
| Источник данных | `pauseLimit` сезона минус `playerState.pauseTime` |
| Отображает | Оставшееся доступное время пауз |

### Состояние стадии (`stage-state`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 200 x 80 пикселей |
| Привязан к игроку | Да |
| Источник данных | Система отслеживания стадий (`stageTracking` в overlayStore) |
| Отображает | Таймер текущей стадии с надписями событий (появление босса, финальный рой, название стадии). Таймер считает вверх или вниз в зависимости от контекста стадии. |
| Дополнительно в контекстном меню | Позиция события: Над таймером / Под таймером |
| Особое поведение | Использует `level_timings.json` для определения времени появления боссов и длительности роя. Определяет переходы стадий по изменениям счётчика убийств и изменениям тира/стадии карты. Надписи исчезают после настраиваемой длительности. |

### История стадий (`stage-history`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 220 x 120 пикселей |
| Привязан к игроку | Да |
| Источник данных | История системы отслеживания стадий (последние 4 стадии) |
| Отображает | Список предыдущих стадий с временем выхода, количеством убийств и процентом сложности для каждой стадии |

### Умные взаимодействия (`smart-interactions`)

| Свойство | Значение |
|----------|----------|
| Категория | `game-info` |
| Размер по умолчанию | 240 x 300 пикселей |
| Привязан к игроку | Да |
| Источник данных | `smartDiffs` в overlayStore (вычисленные разницы между последовательными снимками состояния игры) |
| Отображает | Анимированные уведомления об изменениях характеристик, подборе предметов, повышении уровня оружия/книг |
| Требования | Необходимо включить "Smart Interactions" в расширенных настройках |
| Поведение | Сравнивает последовательные снимки состояния игрока. Обнаруживает изменения характеристик (скалярная разница), святилищ (скалярная разница), оружия/книг (инвентарная разница: добавленные/удалённые/изменения уровня), предметов (инвентарная разница: добавленные/удалённые/изменения количества). Каждое обнаруженное изменение создаёт анимированное уведомление, которое появляется и затухает. |

---

## Элементы матча

### Разница времени (`time-diff`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 120 x 48 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `player1State.timeElapsed` vs `player2State.timeElapsed` |
| Отображает | Разницу времени между игроками в секундах (положительное = игрок 1 впереди) |

### Разница сложности (`difficulty-diff`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 140 x 48 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `player1State.character.stats.difficulty` vs `player2State.character.stats.difficulty` |
| Отображает | Разницу процентов сложности между игроками |

### Разница убийств (`kill-diff`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 120 x 48 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `player1State.combat.killCount` vs `player2State.combat.killCount` |
| Отображает | Разницу счётчиков убийств (положительное = у игрока 1 больше убийств) |

### Ход матча (`match-flow`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 220 x 120 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `queueState`, `roomMeta` |
| Отображает | Статус жизненного цикла матча: позиция в очереди, найден матч, статус принятия, фаза банов, игра идёт, результат матча |

### Поиск матча (`match-search`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 220 x 140 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `queueState` |
| Отображает | Таймер поиска в очереди с анимированным индикатором загрузки. Показывает прошедшее время в очереди, размер очереди, статус. |
| Видимость | Обычно виден во время фазы `searching` |

### Выбор банов (`match-ban-selection`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 220 x 100 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `roomMeta` (статус готовности банов) |
| Отображает | Статус фазы банов: какие игроки подтвердили свои баны |

### Анимация банов (`match-ban-animation`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 220 x 120 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `roomMeta`, `roomBans` |
| Отображает | Анимированный экран "VS" во время фазы выбора банов с превью героев/оружия обоих игроков |

### Ожидание оппонента (`match-opponent-wait`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 220 x 80 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `roomMeta` (доступность данных раунда игрока) |
| Отображает | Сообщение "Ожидание данных оппонента..." когда данные игры оппонента ещё не получены |

### Умный матчмейкинг (`match-smart`)

| Свойство | Значение |
|----------|----------|
| Категория | `match` |
| Размер по умолчанию | 240 x 200 пикселей |
| Привязан к игроку | Нет (общий) |
| Источник данных | `queueState`, `roomMeta`, `roomBans` |
| Отображает | Составной элемент, объединяющий Поиск матча, Выбор/Анимацию банов и Ожидание оппонента в один умный элемент, показывающий соответствующий вид в зависимости от текущей фазы матча |

### Конец матча (`match-end`)

| Свойство | Значение |
|----------|----------|
| Категория | `match-player` |
| Размер по умолчанию | 200 x 60 пикселей |
| Привязан к игроку | Да |
| Источник данных | `roomMeta` (ID победителя, статус игры, фаза) |
| Отображает | Статус конца матча для игрока: Победа, Поражение, Ничья, Смерть, Финиш, Время вышло, Покинул, Отменён |

---

## Элементы сессии

Все элементы сессии являются общими (без привязки к игроку).

### Сводка сессии (`session-summary`)

| Свойство | Значение |
|----------|----------|
| Категория | `session` |
| Размер по умолчанию | 260 x 110 пикселей |
| Источник данных | `sessionStats` (из отслеживания сессии relay-сервера) |
| Отображает | Начальный vs текущий рейтинг, начальный vs текущий ранг, общее изменение рейтинга |

### Текущая сессия (`session-current`)

| Свойство | Значение |
|----------|----------|
| Категория | `session` |
| Размер по умолчанию | 200 x 110 пикселей |
| Источник данных | `sessionStats.currentRating`, `sessionStats.currentRank` |
| Отображает | Текущий рейтинг и ранг с дельтой изменения от начала сессии |

### Рейтинг сессии (`session-rating`)

| Свойство | Значение |
|----------|----------|
| Категория | `session` |
| Размер по умолчанию | 160 x 60 пикселей |
| Источник данных | `sessionStats.currentRating` |
| Отображает | Текущее значение рейтинга сессии |

### Ранг сессии (`session-rank`)

| Свойство | Значение |
|----------|----------|
| Категория | `session` |
| Размер по умолчанию | 160 x 60 пикселей |
| Источник данных | `sessionStats.currentRank` |
| Отображает | Текущий ранг сессии |

### Игры сессии (`session-games`)

| Свойство | Значение |
|----------|----------|
| Категория | `session` |
| Размер по умолчанию | 260 x 140 пикселей |
| Источник данных | Массив `sessionStats.games` |
| Отображает | Последние результаты игр с дельтой рейтинга за каждую игру. Количество отображаемых игр контролируется настройкой Session Games Limit (по умолчанию: 10, максимум: 100). |

---

## Элементы сезона

Все элементы сезона являются общими.

### Информация о сезоне (`season-info`)

| Свойство | Значение |
|----------|----------|
| Категория | `season` |
| Размер по умолчанию | 220 x 140 пикселей |
| Источник данных | `seasonInfo` (из relay-сервера `/api/season`) |
| Отображает | Название сезона, лимит времени, лимит пауз, дата начала, дата окончания |
| Дополнительно в контекстном меню | Палитра цвета текста |

### Название сезона (`season-name`)

| Свойство | Значение |
|----------|----------|
| Категория | `season` |
| Размер по умолчанию | 200 x 40 пикселей |
| Источник данных | `seasonInfo.name` |
| Дополнительно в контекстном меню | Палитра цвета текста |

### Лимит времени сезона (`season-time-limit`)

| Свойство | Значение |
|----------|----------|
| Категория | `season` |
| Размер по умолчанию | 200 x 40 пикселей |
| Источник данных | `seasonInfo.timeLimit` |
| Отображает | Лимит времени в формате минуты:секунды |
| Дополнительно в контекстном меню | Палитра цвета текста |

### Лимит пауз сезона (`season-pause-limit`)

| Свойство | Значение |
|----------|----------|
| Категория | `season` |
| Размер по умолчанию | 200 x 40 пикселей |
| Источник данных | `seasonInfo.pauseLimit` |
| Отображает | Лимит пауз в формате минуты:секунды |
| Дополнительно в контекстном меню | Палитра цвета текста |

### Дата начала сезона (`season-start-date`)

| Свойство | Значение |
|----------|----------|
| Категория | `season` |
| Размер по умолчанию | 200 x 40 пикселей |
| Источник данных | `seasonInfo.startDate` |
| Дополнительно в контекстном меню | Палитра цвета текста |

### Дата окончания сезона (`season-end-date`)

| Свойство | Значение |
|----------|----------|
| Категория | `season` |
| Размер по умолчанию | 200 x 40 пикселей |
| Источник данных | `seasonInfo.endDate` |
| Дополнительно в контекстном меню | Палитра цвета текста |

---

## Элементы банов

Все элементы банов являются общими.

### Баны комнаты (`bans-system`)

| Свойство | Значение |
|----------|----------|
| Категория | `bans` |
| Размер по умолчанию | 280 x 140 пикселей |
| Источник данных | `roomBans.system` |
| Отображает | Системные/общие заблокированные сущности: герои, оружие, книги, предметы (по редкости). На каждой иконке отображается значок бана. |
| Дополнительно в контекстном меню | Лимиты редкости, Порядок предметов, Поток, Выравнивание, Отступы (экспериментально) |
| Переполнение | Видимое |

### Баны игрока 1 (`bans-player1`)

| Свойство | Значение |
|----------|----------|
| Категория | `bans` |
| Размер по умолчанию | 280 x 140 пикселей |
| Источник данных | `roomBans.player1` |
| Отображает | Баны, применяемые К игроку 1 (установленные игроком 2). Забаненные герои, оружие, книги, предметы со значками банов. |
| Важно | Из-за логики инверсии банов, `roomBans.player1` содержит баны, ограничивающие игрока 1, которые были выбраны игроком 2. |

### Баны игрока 2 (`bans-player2`)

Аналогичная структура как у банов игрока 1, но отображает `roomBans.player2` (баны, применяемые К игроку 2, установленные игроком 1).

---

## Элементы разниц

Все элементы разниц являются общими.

### Разница времени (`time-diff`)

См. [Элементы матча > Разница времени](#разница-времени-time-diff).

### Разница сложности (`difficulty-diff`)

См. [Элементы матча > Разница сложности](#разница-сложности-difficulty-diff).

### Разница убийств (`kill-diff`)

См. [Элементы матча > Разница убийств](#разница-убийств-kill-diff).

---

## Элементы фигур

### Цветной блок (`shape-rect`)

| Свойство | Значение |
|----------|----------|
| Категория | `shapes` |
| Размер по умолчанию | 200 x 200 пикселей |
| Привязан к игроку | Да |
| Источник данных | Нет (чисто визуальный элемент) |
| Отображает | Прямоугольник сплошного цвета. Полезен как фон за другими элементами. |
| Дополнительно в контекстном меню | Палитра цвета заливки |
| Цвет заливки по умолчанию | `#000000` (чёрный) |

---

## Фазы видимости в OBS

Элементы можно настроить на отображение только во время определённых фаз матча через контекстное меню **Видимость в OBS**. Доступные фазы:

| Ключ фазы | Название | Активна когда |
|-----------|----------|---------------|
| `idle` | Вне матча | Нет очереди, нет комнаты, нет игры |
| `searching` | Поиск | В очереди матчмейкинга |
| `acceptance` | Принятие матча | Матч найден, ожидание принятия |
| `ban_selection` | Фаза банов | В фазе выбора банов |
| `game` | Игра | Игра в процессе |
| `ended` | Конец матча | Матч завершён, отменён, или игрок погиб/финишировал |

Дополнительно, режим видимости **Во время раунда** (`run`) показывает элемент только, пока раунд текущего пользователя активен (не завершён/отменён/погиб).

Когда **режим OBS Overlay** активен и условия видимости элемента не выполнены, прозрачность элемента устанавливается в `0` (полностью прозрачный), а не удаляется из DOM.

---

## Поведение при завершении матча

Когда матч завершается (или раунд игрока завершается во время игры):

1. К элементам категорий `equipment`, `items`, `stats`, `stats-individual`, `combat`, `combat-individual`, `game-info` и `bans` могут быть применены эффекты завершения матча.
2. Если `blurOnEnd` включён для элемента, применяется CSS-фильтр: `blur({blurAmount}px) saturate({1-desaturate}) brightness({1-dim})`.
3. Если `showEndTitle` включён, на элемент накладывается надпись Победа/Поражение/Ничья/Смерть.
4. Состояние завершения матча активно 2.5 секунды, затем затухает в течение 0.5 секунд.
5. Завершение раунда одного игрока (смерть во время матча, пока матч продолжается) применяет эффекты размытия, но не полностью скрывает элемент.
6. Размытие при завершении раунда игрока может быть включено/отключено независимо для каждого слота игрока.

---

*Этот документ охватывает все 80+ типов элементов MegaBonk Overlay v1.0.3.*
*Последнее обновление: февраль 2026*
